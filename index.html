import React, { useState, useEffect } from 'react';
import { initializeApp } from "firebase/app";
import { getFirestore, collection, getDocs, addDoc, updateDoc, doc, query } from "firebase/firestore";
import { getStorage, ref, uploadBytes, getDownloadURL } from "firebase/storage";
import { 
  Heart, 
  Search, 
  ArrowRightLeft, 
  Trophy, 
  Upload, 
  User, 
  Activity, 
  BookOpen, 
  X,
  Sparkles,
  Palette,
  Baby,
  Image as ImageIcon,
  Stethoscope,
  Info,
  Maximize2
} from 'lucide-react';

// --- 转爪专转 Firebase (注转) ---
const firebaseConfig = {
  apiKey: "AIzaSyC6dTzpoM5pvwAbSMQ2P5yknBhM5-jsTqs",
  authDomain: "pundekait-e3371.firebaseapp.com",
  projectId: "pundekait-e3371",
  storageBucket: "pundekait-e3371.firebasestorage.app",
  messagingSenderId: "842165679300",
  appId: "1:842165679300:web:3c5c599855df1dec5f8591",
  measurementId: "G-4HKTSXW2M4"
};

let db, storage;
try {
  const app = initializeApp(firebaseConfig);
  db = getFirestore(app);
  storage = getStorage(app);
} catch (e) {
  console.error("Firebase init error:", e);
}

// --- 转 专砖 ---
const INITIAL_DATA = [
  {
    id: "DO-1517",
    age: 26,
    height: 169,
    race: "注专 (Mestizo)",
    ethnicity: "住驻/",
    availability: "11-2025",
    hairColor: "砖专",
    hairType: "拽专",
    eyeColor: " ",
    skinColor: " 专",
    occupation: "住转 / 注爪转 专驻转",
    description: "专注, 驻转转, 专转. 转 注  爪转 .",
    hobbies: "拽注拽注, 爪专, 拽专, ",
    image: null,
    gallery: [],
    ranking: 0
  },
  {
    id: "DO-1091",
    age: 28,
    height: 170,
    race: "",
    ethnicity: "住驻/",
    availability: "02-2025",
    hairColor: "砖专",
    hairType: "拽专",
    eyeColor: " ",
    skinColor: "",
    occupation: "驻专转 ",
    description: "专转, 注爪, 爪专转转. 转 .",
    hobbies: ", 爪",
    image: null,
    gallery: [],
    ranking: 0
  },
  {
    id: "DO-1197",
    age: 28,
    height: 172,
    race: "注专",
    ethnicity: "住驻/",
    availability: "11-2025",
    hairColor: "砖专",
    hairType: "拽",
    eyeColor: " ",
    skinColor: "",
    occupation: "转 拽",
    description: "转, 专转转, 专转.",
    hobbies: "转注转, 拽专, 专转 驻",
    image: null,
    gallery: [],
    ranking: 0
  },
  {
    id: "DO-1298",
    age: 27,
    height: 170,
    race: "注专",
    ethnicity: "住驻/",
    availability: "09-2025",
    hairColor: "",
    hairType: "拽",
    eyeColor: "",
    skinColor: "",
    occupation: "转 转",
    description: "住驻转, 砖, 转.",
    hobbies: " 专, 驻",
    image: null,
    gallery: [],
    ranking: 0
  },
  {
    id: "DO-1357",
    age: 28,
    height: 167,
    race: "注专",
    ethnicity: "住驻/",
    availability: "05-2025",
    hairColor: " 专",
    hairType: "",
    eyeColor: "专拽",
    skinColor: "",
    occupation: "拽专转",
    description: "转拽, , 转. 转 专.",
    hobbies: "拽, 专",
    image: null,
    gallery: [],
    ranking: 0
  },
  {
    id: "DO-1468",
    age: 29,
    height: 170,
    race: "注专",
    ethnicity: "住驻/",
    availability: "03-2025",
    hairColor: "",
    hairType: "",
    eyeColor: "专拽",
    skinColor: "",
    occupation: "转 驻专住转",
    description: ", 专转转, 转.",
    hobbies: "砖拽, 驻住",
    image: null,
    gallery: [],
    ranking: 0
  },
  {
    id: "DO-1493",
    age: 23,
    height: 166,
    race: "注专",
    ethnicity: "住驻/",
    availability: "07-2025",
    hairColor: " ",
    hairType: "拽",
    eyeColor: " ",
    skinColor: "",
    occupation: "转 专",
    description: "转, 爪拽, 专转转, 注转 .",
    hobbies: "专拽, 住驻专, 转 住专转",
    image: null,
    gallery: [],
    ranking: 0
  },
  {
    id: "DO-1193",
    age: 19,
    height: 156,
    race: "注专",
    ethnicity: "住驻/",
    availability: "08-2024",
    hairColor: "砖专",
    hairType: "拽",
    eyeColor: " ",
    skinColor: "",
    occupation: "驻专转 拽爪注转",
    description: "砖,  注爪, .",
    hobbies: "转注转 转转, 拽专",
    image: null,
    gallery: [],
    ranking: 0
  }
];

// --- 专 注专 ---

const EggShape = ({ children, title, icon: Icon, onClick, colorClass = "from-white to-pink-50" }) => (
  <div 
    onClick={onClick}
    className="group relative cursor-pointer transition-transform duration-500 hover:-translate-y-2"
    style={{ perspective: '1000px' }}
  >
    {/* 爪专转 爪 */}
    <div 
      className={`
        w-48 h-64 md:w-56 md:h-72 
        bg-gradient-to-br ${colorClass}
        shadow-[inset_-10px_-10px_20px_rgba(0,0,0,0.05),10px_10px_20px_rgba(0,0,0,0.1)]
        border-4 border-white
        flex flex-col items-center justify-center text-center p-6
        relative overflow-hidden
        group-hover:shadow-pink-200 group-hover:shadow-2xl
        transition-all duration-300
      `}
      style={{ 
        borderRadius: '50% 50% 50% 50% / 60% 60% 40% 40%', 
        animation: 'float 6s ease-in-out infinite'
      }}
    >
      <div className="bg-white/50 p-4 rounded-full mb-3 text-pink-600 backdrop-blur-sm group-hover:scale-110 transition-transform">
        <Icon size={32} />
      </div>
      <h3 className="font-bold text-gray-800 text-lg mb-1 tracking-wide">{title}</h3>
      <span className="text-xs text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity font-normal">抓 驻转</span>
      
      <div className="absolute top-4 right-8 w-12 h-6 bg-white/40 rounded-full rotate-[-45deg] filter blur-md"></div>
    </div>
  </div>
);

const Modal = ({ isOpen, onClose, title, children, icon: Icon, maxWidth = "max-w-2xl" }) => {
  if (!isOpen) return null;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
      <div 
        className={`bg-white rounded-3xl w-full ${maxWidth} max-h-[90vh] overflow-y-auto shadow-2xl border-4 border-pink-100 relative animate-scale-up`}
        onClick={(e) => e.stopPropagation()}
      >
        <button 
          onClick={onClose}
          className="absolute top-4 left-4 p-2 bg-gray-100 hover:bg-pink-100 rounded-full transition-colors z-10"
        >
          <X size={20} className="text-gray-600" />
        </button>
        
        <div className="bg-pink-50 p-6 flex items-center gap-3 border-b border-pink-100">
          <div className="bg-white p-2 rounded-full text-pink-500 shadow-sm">
            <Icon size={24} />
          </div>
          <h2 className="text-2xl font-bold text-gray-800">{title}</h2>
        </div>
        
        <div className="p-8">
          {children}
        </div>
      </div>
    </div>
  );
};

const ImageUploader = ({ donorId, onUpload, type = "main", compact = false }) => {
  const [uploading, setUploading] = useState(false);
  const [isDragging, setIsDragging] = useState(false);

  const handleFile = async (file) => {
    if (!file) return;
    setUploading(true);
    
    //  Firebase  转  砖爪专 (专 注 拽驻专爪 砖)
    if (!storage) {
        console.warn("Storage not available");
        setUploading(false);
        return;
    }

    try {
      const storageRef = ref(storage, `donors/${donorId}/${type}_${Date.now()}_${file.name}`);
      const snapshot = await uploadBytes(storageRef, file);
      const downloadURL = await getDownloadURL(snapshot.ref);
      onUpload(downloadURL);
    } catch (error) {
      console.error("Upload error:", error);
      alert("砖 注转 转.  砖拽  -Firebase 驻砖专 转 (Test Mode).");
    } finally {
      setUploading(false);
    }
  };

  const handleDrop = (e) => {
    e.preventDefault();
    setIsDragging(false);
    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
      handleFile(e.dataTransfer.files[0]);
    }
  };

  return (
    <div 
      onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}
      onDragLeave={() => setIsDragging(false)}
      onDrop={handleDrop}
      className={`
        border-2 border-dashed rounded-xl text-center transition-all duration-300 cursor-pointer relative overflow-hidden
        ${isDragging ? 'border-pink-500 bg-pink-100 scale-105' : 'border-gray-300 hover:border-pink-400 bg-gray-50 hover:bg-pink-50'}
        ${compact ? 'p-2' : 'p-6'}
      `}
    >
      <input 
        type="file" 
        className="hidden" 
        id={`file-${donorId}-${type}`}
        accept="image/*"
        onChange={(e) => handleFile(e.target.files[0])}
      />
      <label htmlFor={`file-${donorId}-${type}`} className="cursor-pointer flex flex-col items-center justify-center gap-2 h-full w-full">
        {uploading ? (
          <div className="animate-spin h-6 w-6 border-2 border-pink-500 rounded-full border-t-transparent"></div>
        ) : (
          <>
            <Upload size={compact ? 16 : 24} className="text-gray-400 group-hover:text-pink-500" />
            <span className={`font-medium text-gray-600 ${compact ? 'text-xs' : 'text-sm'}`}>
                {type === 'main' ? '转 专砖转' : '住祝 专'}
            </span>
          </>
        )}
      </label>
    </div>
  );
};

export default function App() {
  const [donors, setDonors] = useState([]);
  const [selectedDonorId, setSelectedDonorId] = useState(null);
  const [activeTab, setActiveTab] = useState('view');
  const [activeEgg, setActiveEgg] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [zoomedImage, setZoomedImage] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      // 住 砖祝 -Firebase
      if (db) {
          try {
            const q = query(collection(db, "donors"));
            const snapshot = await getDocs(q);
            if (!snapshot.empty) {
                const fetchedDonors = snapshot.docs.map(d => ({...d.data(), firestoreId: d.id}));
                //  住专 转专转 ( -DB 专拽),  注 专砖
                if (fetchedDonors.length < INITIAL_DATA.length) {
                     setDonors(INITIAL_DATA); //    转专,  驻砖 砖转砖 转   专拽
                } else {
                    setDonors(fetchedDonors);
                }
            } else {
                // DB 专拽 专? 砖转砖 转 拽注
                setDonors(INITIAL_DATA);
            }
          } catch (e) {
            console.error("Error fetching from Firebase:", e);
            setDonors(INITIAL_DATA);
          }
      } else {
          setDonors(INITIAL_DATA);
      }
    };
    fetchData();
  }, []);

  const handleUpdateDonor = async (id, newData) => {
    // 1. 注 驻 () 砖拽
    const updatedDonors = donors.map(d => d.id === id ? { ...d, ...newData } : d);
    setDonors(updatedDonors);
    
    // 2. 砖专 -Firebase
    if (db) {
        try {
            const donor = donors.find(d => d.id === id);
            
            // 拽  转专转 专 砖 专砖 注
            if (donor.firestoreId) {
                // 注 住 拽
                const donorRef = doc(db, "donors", donor.firestoreId);
                await updateDoc(donorRef, newData);
                console.log("Updated donor in Firebase");
            } else {
                // 爪专转 住 砖 转专转 驻注 专砖
                //  砖专 转  注 砖 转专转 + 注 砖
                const fullData = { ...donor, ...newData };
                const docRef = await addDoc(collection(db, "donors"), fullData);
                
                // 注 -State 注 -ID 砖 砖拽 注
                const newDonorsWithId = updatedDonors.map(d => 
                    d.id === id ? { ...d, firestoreId: docRef.id } : d
                );
                setDonors(newDonorsWithId);
                console.log("Created new donor in Firebase");
            }
        } catch (error) {
            console.error("Error saving to Firebase:", error);
        }
    }
  };

  const selectedDonor = donors.find(d => d.id === selectedDonorId);
  const filteredDonors = donors.filter(d => d.id.toLowerCase().includes(searchTerm.toLowerCase()));

  return (
    <div className="flex h-screen bg-[#f8f9fa] font-sans text-gray-800 overflow-hidden" dir="rtl">
      
      <style>
        {`
          @import url('https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
          
          * {
            font-family: 'Rubik', sans-serif !important;
          }
          
          h1, h2, h3, h4, h5, h6, .font-bold {
            font-weight: 700 !important;
          }
          
          body, p, span, div, input, button {
            font-weight: 400;
          }
          
          .quote-text {
            font-style: italic !important;
            font-weight: 400 !important;
          }

          @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
          }
          @keyframes fade-in {
              from { opacity: 0; }
              to { opacity: 1; }
          }
          @keyframes slide-down {
              from { opacity: 0; transform: translateY(-20px); }
              to { opacity: 1; transform: translateY(0); }
          }
          @keyframes scale-up {
              from { opacity: 0; transform: scale(0.9); }
              to { opacity: 1; transform: scale(1); }
          }
          .animate-fade-in { animation: fade-in 0.3s ease-out; }
          .animate-slide-down { animation: slide-down 0.5s ease-out; }
          .animate-scale-up { animation: scale-up 0.3s ease-out cubic-bezier(0.175, 0.885, 0.32, 1.275); }
          
          .custom-scrollbar::-webkit-scrollbar { width: 6px; }
          .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
          .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #fce7f3; border-radius: 20px; }
          .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #fbcfe8; }
        `}
      </style>

      {/* Sidebar */}
      <aside className="w-80 bg-white border-l border-gray-200 flex flex-col shadow-lg z-20">
        <div className="p-6 border-b border-pink-100 bg-pink-50/50">
          <div className="flex items-center gap-3 mb-4">
            <div className="bg-pink-500 text-white p-2 rounded-xl shadow-lg shadow-pink-200">
               <Baby size={24} />
            </div>
            <h1 className="text-xl text-gray-800 tracking-tight">EGG BANK</h1>
          </div>
          
          <div className="relative">
            <Search className="absolute right-3 top-2.5 text-gray-400" size={16} />
            <input 
              type="text"
              placeholder="驻砖 驻 住驻专..."
              className="w-full bg-white border border-gray-200 rounded-lg py-2 pr-10 pl-4 text-sm focus:ring-2 focus:ring-pink-200 focus:border-pink-300 outline-none transition-all"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </div>

        <div className="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar">
          {filteredDonors.map(donor => (
            <div 
              key={donor.id}
              onClick={() => { setSelectedDonorId(donor.id); setActiveTab('view'); }}
              className={`
                group flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all duration-200 border
                ${selectedDonorId === donor.id 
                  ? 'bg-pink-600 border-pink-600 text-white shadow-md shadow-pink-200 transform scale-[1.02]' 
                  : 'bg-white border-transparent hover:border-pink-200 hover:bg-pink-50 text-gray-600'}
              `}
            >
              <div className={`
                w-12 h-12 rounded-full overflow-hidden border-2 flex-shrink-0
                ${selectedDonorId === donor.id ? 'border-white/30' : 'border-gray-100 group-hover:border-pink-200'}
              `}>
                {donor.image ? (
                  <img src={donor.image} alt={donor.id} className="w-full h-full object-cover" />
                ) : (
                  <div className={`w-full h-full flex items-center justify-center ${selectedDonorId === donor.id ? 'bg-white/20' : 'bg-gray-100'}`}>
                    <User size={20} />
                  </div>
                )}
              </div>
              
              <div className="flex-1 min-w-0">
                <h4 className="text-sm truncate font-bold">{donor.id}</h4>
                <div className="flex items-center gap-2 text-xs opacity-90 truncate">
                  <span>转 {donor.age}</span>
                  <span className="w-1 h-1 rounded-full bg-current"></span>
                  <span>{donor.height} 住"</span>
                </div>
              </div>
              
              {selectedDonorId === donor.id && (
                <div className="animate-pulse">
                    <Heart size={16} fill="currentColor" />
                </div>
              )}
            </div>
          ))}
        </div>

        <div className="p-4 border-t border-gray-200 bg-gray-50 flex gap-2">
            <button 
                onClick={() => { setSelectedDonorId(null); setActiveTab('compare'); }}
                className={`flex-1 flex flex-col items-center gap-1 p-2 rounded-lg text-xs font-medium transition-colors ${activeTab === 'compare' ? 'bg-white text-pink-600 shadow-sm' : 'text-gray-500 hover:bg-white'}`}
            >
                <ArrowRightLeft size={20} />
                砖
            </button>
            <button 
                onClick={() => { setSelectedDonorId(null); setActiveTab('ranking'); }}
                className={`flex-1 flex flex-col items-center gap-1 p-2 rounded-lg text-xs font-medium transition-colors ${activeTab === 'ranking' ? 'bg-white text-pink-600 shadow-sm' : 'text-gray-500 hover:bg-white'}`}
            >
                <Trophy size={20} />
                专
            </button>
        </div>
      </aside>

      {/* Main Content */}
      <main className="flex-1 relative overflow-hidden bg-gradient-to-br from-[#fdfbf7] to-[#fff0f5]">
        
        <div className="absolute top-0 right-0 w-full h-full opacity-30 pointer-events-none" 
             style={{ backgroundImage: 'radial-gradient(#e5e7eb 1px, transparent 1px)', backgroundSize: '30px 30px' }}></div>

        {!selectedDonorId && activeTab === 'view' && (
             <div className="h-full flex flex-col items-center justify-center text-center p-8 animate-fade-in">
                <div className="w-48 h-64 bg-white rounded-[50%_50%_50%_50%_/_60%_60%_40%_40%] shadow-xl border-4 border-white mb-6 flex items-center justify-center relative">
                    <span className="text-6xl animate-bounce"></span>
                    <div className="absolute -bottom-4 bg-gray-200/50 w-32 h-4 rounded-[50%] blur-md"></div>
                </div>
                <h2 className="text-3xl text-gray-800 mb-2">专  专 爪转</h2>
                <p className="text-gray-500 max-w-md">专 转专转 转驻专   爪驻转 驻专,  砖转砖  砖 专 .</p>
             </div>
        )}

        {selectedDonor && activeTab === 'view' && (
          <div className="h-full overflow-y-auto p-8 md:p-12 relative">
            
            <div className="flex flex-col md:flex-row items-center justify-between mb-12 gap-6 animate-slide-down">
                <div className="flex items-center gap-6">
                    <div className="relative">
                        <div className="w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg">
                            {selectedDonor.image ? (
                                <img src={selectedDonor.image} alt="" className="w-full h-full object-cover" />
                            ) : (
                                <div className="w-full h-full bg-pink-100 flex items-center justify-center text-pink-300"><User size={40}/></div>
                            )}
                        </div>
                        <div className="absolute -bottom-2 -left-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full shadow-sm border-2 border-white font-medium">
                            : {selectedDonor.availability}
                        </div>
                    </div>
                    <div>
                        <h2 className="text-4xl text-gray-800 mb-1">转专转 {selectedDonor.id}</h2>
                        <p className="text-gray-500 text-lg flex items-center gap-2">
                           <Sparkles size={16} className="text-yellow-500" />
                           {selectedDonor.occupation}
                        </p>
                    </div>
                </div>
                
                <div className="flex gap-4">
                    <div className="bg-white/80 backdrop-blur px-4 py-2 rounded-2xl shadow-sm border border-pink-100 text-center">
                        <span className="block text-2xl font-bold text-pink-600">{selectedDonor.age}</span>
                        <span className="text-xs text-gray-500 font-medium"></span>
                    </div>
                    <div className="bg-white/80 backdrop-blur px-4 py-2 rounded-2xl shadow-sm border border-pink-100 text-center">
                        <span className="block text-2xl font-bold text-pink-600">{selectedDonor.height}</span>
                        <span className="text-xs text-gray-500 font-medium">住"</span>
                    </div>
                </div>
            </div>

            <div className="flex flex-wrap items-center justify-center gap-8 md:gap-12 pb-20">
                <EggShape 
                    title=" ?" 
                    icon={Info} 
                    onClick={() => setActiveEgg('bio')}
                    colorClass="from-blue-50 to-blue-100"
                />
                <EggShape 
                    title="专 爪" 
                    icon={Palette} 
                    onClick={() => setActiveEgg('looks')}
                    colorClass="from-purple-50 to-purple-100"
                />
                <EggShape 
                    title="专转 住专" 
                    icon={Stethoscope} 
                    onClick={() => setActiveEgg('medical')}
                    colorClass="from-green-50 to-green-100"
                />
                <EggShape 
                    title="住驻专 砖" 
                    icon={BookOpen} 
                    onClick={() => setActiveEgg('story')}
                    colorClass="from-pink-50 to-pink-100"
                />
            </div>
          </div>
        )}

        {activeTab !== 'view' && (
            <div className="h-full flex flex-col items-center justify-center text-gray-400">
                <div className="text-6xl mb-4"></div>
                <h3 className="text-xl">专 {activeTab === 'compare' ? '砖' : '专'}</h3>
                <p> 驻注 转 专住 拽转</p>
            </div>
        )}
      </main>

      {/* --- Overlays --- */}

      {/* Bio Overlay */}
      <Modal 
        isOpen={activeEgg === 'bio'} 
        onClose={() => setActiveEgg(null)}
        title="驻专驻 砖"
        icon={User}
      >
         <div className="space-y-6">
            <p className="text-xl text-center text-gray-600 leading-relaxed quote-text">
                "{selectedDonor?.description}"
            </p>
            <div className="grid grid-cols-2 gap-4 bg-gray-50 p-6 rounded-2xl">
                <div>
                    <span className="block text-xs text-gray-400 mb-1">注住拽</span>
                    <span className="font-semibold text-lg">{selectedDonor?.occupation}</span>
                </div>
                <div>
                    <span className="block text-xs text-gray-400 mb-1">爪</span>
                    <span className="font-semibold text-lg">{selectedDonor?.race}</span>
                </div>
                <div>
                    <span className="block text-xs text-gray-400 mb-1">转转</span>
                    <span className="font-semibold text-lg">{selectedDonor?.ethnicity}</span>
                </div>
            </div>
         </div>
      </Modal>

      {/* Looks Overlay - 注 转转 专专 */}
      <Modal 
        isOpen={activeEgg === 'looks'} 
        onClose={() => setActiveEgg(null)}
        title="专 转"
        icon={Palette}
        maxWidth="max-w-4xl" // 专 转   砖 拽 转转
      >
         <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
             
             {/* 爪 : 转 砖 */}
             <div className="space-y-4">
                 <h3 className="font-bold text-gray-700 border-b pb-2 mb-4">转 驻</h3>
                 <div className="grid grid-cols-2 gap-4">
                    {[
                        { label: '爪注 砖注专', val: selectedDonor?.hairColor },
                        { label: '住 砖注专', val: selectedDonor?.hairType },
                        { label: '爪注 注', val: selectedDonor?.eyeColor },
                        { label: ' 注专', val: selectedDonor?.skinColor },
                        { label: '', val: `${selectedDonor?.height} 住"` },
                        { label: '', val: selectedDonor?.age },
                    ].map((item, idx) => (
                        <div key={idx} className="bg-gray-50 border border-gray-100 shadow-sm p-4 rounded-xl text-center hover:border-pink-200 transition-colors">
                            <span className="block text-gray-400 text-xs mb-1">{item.label}</span>
                            <span className="text-gray-800 font-bold">{item.val}</span>
                        </div>
                    ))}
                 </div>
             </div>

             {/* 爪 砖:  转转 */}
             <div className="space-y-4">
                 <h3 className="font-bold text-gray-700 border-b pb-2 mb-4">转转 专</h3>
                 
                 {/* 转 专砖转  */}
                 <div className="relative group rounded-2xl overflow-hidden shadow-md h-64 bg-gray-100">
                    {selectedDonor?.image ? (
                        <img src={selectedDonor.image} alt="main" className="w-full h-full object-cover" />
                    ) : (
                        <div className="w-full h-full flex items-center justify-center text-gray-300 flex-col gap-2">
                            <ImageIcon size={48} />
                            <span> 转 专砖转</span>
                        </div>
                    )}
                    
                    {/* 专 注 砖拽祝 注  转 专砖转 专专 */}
                    <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center p-4">
                        <div className="w-full h-full">
                            <ImageUploader 
                                donorId={selectedDonor?.id}
                                type="main"
                                onUpload={(url) => handleUpdateDonor(selectedDonor.id, { image: url })}
                            />
                        </div>
                    </div>
                 </div>

                 {/* 专 拽 */}
                 <div>
                     <p className="text-xs text-gray-400 mb-2 font-bold">专 住驻转 (抓 )</p>
                     <div className="grid grid-cols-4 gap-2">
                        {selectedDonor?.gallery?.map((img, idx) => (
                            <div 
                                key={idx} 
                                onClick={() => setZoomedImage(img)}
                                className="aspect-square rounded-lg overflow-hidden shadow-sm cursor-zoom-in hover:opacity-80 transition-opacity relative border border-gray-200"
                            >
                                <img src={img} alt="gallery" className="w-full h-full object-cover" />
                            </div>
                        ))}
                        
                        {/* 驻转专 住驻 专 */}
                        <div className="aspect-square">
                            <ImageUploader 
                                donorId={selectedDonor?.id}
                                type="gallery"
                                compact={true}
                                onUpload={(url) => {
                                    const currentGallery = selectedDonor.gallery || [];
                                    handleUpdateDonor(selectedDonor.id, { gallery: [...currentGallery, url] });
                                }}
                            />
                        </div>
                     </div>
                 </div>
             </div>
         </div>
      </Modal>

      {/* Story Overlay */}
      <Modal 
        isOpen={activeEgg === 'story'} 
        onClose={() => setActiveEgg(null)}
        title="转 转"
        icon={BookOpen}
      >
         <div className="bg-yellow-50 p-6 rounded-2xl border border-yellow-100 mb-6">
             <h4 className="text-yellow-800 mb-3 flex items-center gap-2 font-bold">
                 <Sparkles size={18}/>
                 转
             </h4>
             <div className="flex flex-wrap gap-2">
                 {selectedDonor?.hobbies.split(',').map((hob, i) => (
                     <span key={i} className="bg-white text-gray-700 px-3 py-1.5 rounded-full text-sm shadow-sm border border-yellow-100">
                         {hob.trim()}
                     </span>
                 ))}
             </div>
         </div>
         <p className="text-gray-600 leading-relaxed">
             ( 转 住祝 爪 住驻 -PDF  转 转  专转 注转)
         </p>
      </Modal>

      {/* Medical Overlay */}
      <Modal 
        isOpen={activeEgg === 'medical'} 
        onClose={() => setActiveEgg(null)}
        title="注 专驻"
        icon={Stethoscope}
      >
          <div className="text-center py-12 bg-green-50 rounded-2xl border border-green-100 border-dashed">
              <Activity size={48} className="mx-auto text-green-300 mb-4" />
              <h3 className="text-green-800 text-lg font-bold">专转 转拽</h3>
              <p className="text-green-600 max-w-sm mx-auto mt-2">
                   拽转 转 专驻转 爪 转拽转 (注 驻 注 拽抓).
                  爪驻   砖 爪专 拽砖专 注 专驻.
              </p>
          </div>
      </Modal>

      {/* Lightbox 转 转转 */}
      {zoomedImage && (
          <div 
            className="fixed inset-0 z-[60] bg-black/90 flex items-center justify-center p-4 animate-fade-in cursor-zoom-out"
            onClick={() => setZoomedImage(null)}
          >
              <button className="absolute top-4 right-4 text-white p-2 hover:bg-white/20 rounded-full">
                  <X size={32} />
              </button>
              <img 
                src={zoomedImage} 
                alt="Zoomed" 
                className="max-w-full max-h-full rounded-lg shadow-2xl animate-scale-up"
                onClick={(e) => e.stopPropagation()} // 注 住专 爪 注 转 注爪
              />
          </div>
      )}

    </div>
  );
}
